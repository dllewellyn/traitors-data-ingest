# Agent Memory & Performance
## Lessons Learned
- **2026-01-15**: System initialized.
- **2026-01-15**: Constitution ratified: Enforcing strict TypeScript, >90% test coverage, and Conventional Commits for all contributions.
- **2026-01-15**: Explicitly document the status of ongoing objectives in GOALS.md to provide clear visibility into-progress versus completed scope.
- **2026-01-15**: Enforce consistent formatting in documentation files, such as ensuring trailing newlines, to maintain clean version control diffs.
- **2026-01-15**: Avoid committing internal planning notes or scratchpad text to project documentation files like TASKS.md to maintain clarity and focus.
- **2026-01-15**: Decouple Express application configuration (`src/app.ts`) from server startup (`src/index.ts`) to enable efficient integration testing with Supertest.
- **2026-01-15**: Adopt multi-stage Docker builds to ensure lightweight production images while maintaining a full-featured development environment.
- **2026-01-15**: Maintain a strict separation between data transfer objects (e.g., CSV row interfaces) and core domain models to facilitate clean data transformation and validation logic.
- **2026-01-15**: When modeling entities with temporal state changes, encapsulate state history within the entity (e.g., `roundStates`) to enable historical analysis.
- **2026-01-16**: Implement comprehensive type guards for parsing and validating untrusted external data, ensuring data integrity and system stability.
- **2026-01-16**: Thoroughly test utility functions, especially type guards, to guarantee their correctness and robustness across various data types and edge cases.
- **2026-01-16**: Develop dedicated, well-tested utility functions for common data transformations (e.g., normalization) to ensure data consistency and reduce redundancy across the codebase.
- **2026-01-16**: Implement robust data normalization logic to handle variations in input data, such as removing extraneous information (e.g., annotations like '[a]', '[b]' from names) and standardizing formats (e.g., ISO 8601 for dates).
- **2026-01-16**: Structure the project as a monorepo with local packages linked via `file:` protocol to enforce modularity and separation of concerns.
- **2026-01-16**: Automate the build process for local packages using a custom script invoked via the `prebuild` hook to ensure dependencies are compiled before the main application.
- **2026-01-16**: Verify the integration of local packages using dedicated test suites to ensure correct dependency resolution and module exports.
- **2026-01-16**: Wrap external libraries (e.g., HTML parsers) behind domain-specific interfaces and type aliases to decouple the application code from specific implementation details.
- **2026-01-16**: Implement exponential backoff retry strategies for external network calls to handle transient failures gracefully and avoid overwhelming remote servers.
- **2026-01-16**: Use custom error classes to wrap low-level infrastructure errors (e.g., network failures), providing semantic meaning to exceptions for better upstream handling.
- **2026-01-16**: Implement fault-tolerant parsing logic that skips malformed data rows (logging warnings) rather than aborting the entire process, ensuring maximum data recovery.
- **2026-01-16**: Locate HTML tables relative to semantic headings (e.g., finding an `h2` and selecting the next `table`) to improve resilience against minor layout changes compared to absolute CSS selectors.
- **2026-01-16**: When a dedicated logging infrastructure is missing, use standard console methods with explicit linting suppressions (`eslint-disable-next-line no-console`) to maintain visibility into non-fatal errors during development.
- **2026-01-16**: Define generic interfaces (e.g., `TableParser<T>`) for common parsing operations to promote consistency and interchangeability of implementations.
- **2026-01-16**: Utilize `csv-stringify` for robust CSV generation, ensuring proper handling of special characters (quotes, newlines) and header management.
- **2026-01-16**: When implementing file writers, always ensure the target directory exists (`fs.mkdir({ recursive: true })`) before attempting to write to avoid `ENOENT` errors.
- **2026-01-16**: Verify file system operations with integration tests that cover edge cases like deep directory structures, empty datasets, and special character escaping.
- **2026-01-16**: Isolate file system tests by using dedicated temporary directories and ensuring cleanup (`fs.rm({ recursive: true, force: true })`) to prevent state leakage.
- **2026-01-16**: Utilize regular expressions with non-greedy captures and optional groups to robustly extract structured data from composite strings.
- **2026-01-16**: Design parsing utilities to return `null` for unparseable inputs instead of throwing exceptions, forcing the consumer to explicitly handle invalid data.
- **2026-01-16**: Provide safe default values (e.g., `0`) when parsing optional numeric fields to maintain type safety when source data is missing.
- **2026-01-16**: Use explicit linting suppressions (` @typescript-eslint/no-explicit-any`) in tests when verifying runtime resilience against invalid types.
- **2026-01-16**: When parsing complex HTML tables with merged cells, implement explicit state tracking for `rowspan` and `colspan` (e.g., using a `pendingSpans` buffer) to correctly map values to the underlying grid.
- **2026-01-16**: Employ heuristic filtering with keyword blocklists to distinguish valid data rows from embedded metadata or sub-headers within loosely structured HTML tables.
- **2026-01-16**: Centralize domain status mapping in normalizers to handle synonyms and infer default states from ambiguous cell content (e.g., treating voting records as "Safe").
- **2026-01-17**: Adopt a hybrid data persistence model: commit CSV snapshots to the repository for auditability and transparency, while leveraging cloud storage for automated, scheduled data ingestion pipelines.
- **2026-01-17**: Configure test runners (e.g., Jest) to discover tests in both source (`src/`) and dedicated test directories (`tests/`) to support separated unit and integration test strategies.
- **2026-01-17**: Implement snapshot-based integration tests for data scrapers using local HTML fixtures and "golden" output files (e.g., CSVs) to ensure deterministic and accurate end-to-end validation.
- **2026-01-17**: Enhance regex patterns in parsers to robustly handle and strip optional trailing metadata or citation markers (e.g., `[a]`) to prevent data pollution.
- **2026-01-17**: Use strategy-based mocks (e.g., `FileBasedFetcher`) in integration tests to decouple execution from external network dependencies while maintaining realistic input data.
- **2026-01-17**: Explicitly flatten complex nested data structures (e.g., JSON objects) into string representations before serializing to CSV to ensure output validity and readability.