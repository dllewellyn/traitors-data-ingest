# Monitoring and Dashboards

This document outlines how to set up monitoring for the Traitors API using the structured logs generated by the Cloud Functions.

## 1. Create Log-Based Metrics

Navigate to **Logs-based Metrics** in the Google Cloud Console and create the following metrics.

### a. API Request Count

- **Name:** `api-request-count`
- **Description:** Counts the number of API requests received.
- **Metric Type:** Counter
- **Log query:**
  ```
  resource.type="cloud_function"
  resource.labels.function_name="api"
  jsonPayload.message="Request received"
  ```

### b. API Error Count (Server Errors)

- **Name:** `api-server-error-count`
- **Description:** Counts the number of API requests that result in a server-side error.
- **Metric Type:** Counter
- **Log query:**
  ```
  resource.type="cloud_function"
  resource.labels.function_name="api"
  severity="ERROR"
  ```

## 2. Create a Monitoring Dashboard

Navigate to **Dashboards** in the Google Cloud Console and create a new dashboard. Add the following widgets:

### a. API Request Rate

- **Title:** API Request Rate
- **Chart Type:** Line Chart
- **Metric:** `logging/user/api-request-count`
- **Aggregation:** `sum`

### b. Server Error Rate (5xx)

- **Title:** Server Error Rate (5xx)
- **Chart Type:** Line Chart
- **Metric:** `logging/user/api-server-error-count`
- **Aggregation:** `sum`
